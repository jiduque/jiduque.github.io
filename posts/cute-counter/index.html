<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Cute Counter" /><meta name="author" content="Jorge Duque" /><meta property="og:locale" content="en_US" /><meta name="description" content="The Problem Even though counting seems like an easy problem, it can have its difficulties. When data is streaming, we assume a nearly endless influx of data. This means that when we are counting something, we could reach some large numbers. We would like to get a way to estimate large counts, but use memory efficiently." /><meta property="og:description" content="The Problem Even though counting seems like an easy problem, it can have its difficulties. When data is streaming, we assume a nearly endless influx of data. This means that when we are counting something, we could reach some large numbers. We would like to get a way to estimate large counts, but use memory efficiently." /><link rel="canonical" href="https://jiduque.github.io/posts/cute-counter/" /><meta property="og:url" content="https://jiduque.github.io/posts/cute-counter/" /><meta property="og:site_name" content="Jorge Duque" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-27T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Cute Counter" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Jorge Duque"},"description":"The Problem Even though counting seems like an easy problem, it can have its difficulties. When data is streaming, we assume a nearly endless influx of data. This means that when we are counting something, we could reach some large numbers. We would like to get a way to estimate large counts, but use memory efficiently.","url":"https://jiduque.github.io/posts/cute-counter/","@type":"BlogPosting","headline":"Cute Counter","dateModified":"2022-08-31T20:06:22-05:00","datePublished":"2022-08-27T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jiduque.github.io/posts/cute-counter/"},"@context":"https://schema.org"}</script><title>Cute Counter | Jorge Duque</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Jorge Duque"><meta name="application-name" content="Jorge Duque"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/34616214?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Jorge Duque</a></div><div class="site-subtitle font-italic">Problems & Ramblings</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/jiduque" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/jiduque" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jor.duqu','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Cute Counter</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Cute Counter</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Jorge Duque </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Aug 27, 2022, 12:00 AM -0500" prep="on" > Aug 27, 2022 <i class="unloaded">2022-08-27T00:00:00-05:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Aug 31, 2022, 8:06 PM -0500" prefix="Updated " > Aug 31, 2022 <i class="unloaded">2022-08-31T20:06:22-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="646 words">3 min</span></div></div><div class="post-content"><h2 id="the-problem">The Problem</h2><p>Even though counting seems like an easy problem, it can have its difficulties. When data is streaming, we assume a nearly endless influx of data. This means that when we are counting something, we could reach some large numbers. We would like to get a way to estimate large counts, but use memory efficiently.</p><h2 id="moriss-algorithm">Moris’s Algorithm</h2><p><a href="https://en.wikipedia.org/wiki/Approximate_counting_algorithm">Moris’s Algorithm</a> is a clever solution for this. The algorithm is as follows.</p><ol><li>Intitialize $x \to 0$<li>When event of interest occurs, increment $x$ by 1 with probability $\frac{1}{2^x}$<li>Repeat step 2</ol><p>Below is a class that implements this counter in python.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>


<span class="k">class</span> <span class="nc">CuteCounter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">():</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">query</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>

</pre></table></code></div></div><h2 id="analysis">Analysis</h2><h3 id="unbiased-estimator">(Unbiased) Estimator</h3>\[E\left[b^{X_n} | X_{n-1} \right] = b^{X_{n-1} + 1} \frac{1}{b^{X_{n-1}}} + b^{X_{n-1}} \left( 1 - \frac{1}{b^{X_{n-1}}}\right) = b + b^{X_{n-1}} - 1\]<p>Which means \(E\left[b^{X_n}\right] = \sum E\left[b^{X_n} | X_{n-1} \right] P(X_{n-1})\)</p>\[= \sum \left[ b + b^{X_{n-1}} - 1\right] P(X_{n-1}) = b + \sum b^{X_{n-1}}P(X_{n-1}) - 1\] \[= b - 1 + E\left[ b^{X_{n-1}} \right]\]<p>This forms a recursive formula for the expected value. Pairing it with the fact that $X_0 = 0$, we can solve this exactly.</p>\[E\left[b^{X_n}\right] = (b - 1)n + 1\]<p>This means that in order to have an unbiased estimator, we should use the following as our estimator, $\hat{n}$.</p>\[\hat{n} = \frac{b^{X_n} - 1}{b - 1}\]<p>For the case of the base being 2, we get the value we used in the code snippet shown above.</p><h3 id="error--variance">Error &amp; Variance</h3><p>Ideally, the variance of the estimator should be small. Because the variance measures how far a value deviates from the mean, the variance can be thought of as an error for our problem.</p>\[\text{Var}\left[\hat{n} \right] = \text{Var}\left[\frac{b^{X_n} - 1}{b - 1} \right] = \frac{1}{(b - 1)^2} \text{Var}\left[b^{X_n} \right]\]<p>Recall that $\text{Var}\left[b^{X_n} \right] = E\left[b^{2X_n}\right] - E\left[b^{X_n}\right]^2 $. The second term in the right-hand expression is something we already know, so let’s solve for the first term. Since we’re going to solve for it using conditionals, let’s solve the conitional expectation.</p>\[E\left[b^{2X_n} | X_{n-1} \right] = b^{2(X_{n-1} + 1)} \frac{1}{b^{X_{n-1}}} + b^{2X_{n-1}} \left( 1 - \frac{1}{b^{X_{n-1}}} \right) = b^{X_{n-1} + 2} + b^{2X_{n-1}} - b^{X_{n-1}}\]<p>This then implies the following.</p>\[E\left[b^{2X_n}\right] = \sum \left( b^{X_{n-1} + 2} + b^{2X_{n-1}} - b^{X_{n-1}} \right) P(X_{n-1})\] \[= b^2 \sum b^{X_{n-1}} P(X_{n-1}) + \sum b^{2X_{n-1}} P(X_{n-1}) - \sum b^{X_{n-1}} P(X_{n-1})\] \[= \left(b^2 - 1 \right) \sum b^{X_{n-1}} P(X_{n-1}) + \sum b^{2X_{n-1}} P(X_{n-1})\] \[= \left(b^2 - 1 \right) E\left[ 2^{X_{n-1}}\right] + E\left[b^{2X_{n-1}}\right]\]<p>Like we did for the mean, we can solve this recursively and get the following result.</p>\[E\left[b^{2X_n}\right] = \left( b^2 - 1\right) \sum_{k=1}^n k = \left( b^2 - 1\right)\frac{n (n+1)}{2}\]<p>Plugging this into the variance formula, we get:</p>\[\text{Var}\left[b^{X_n} \right] = \left( b^2 - 1\right)\frac{n (n+1)}{2} - ((b - 1)n + 1)^2\]<p>Putting it all together, we get:</p>\[\text{Var}\left[\hat{n} \right] = \frac{1}{(b - 1)^2} \left[\left( b^2 - 1\right)\frac{n (n+1)}{2} - ((b - 1)n + 1)^2 \right]\] \[= \frac{(b + 1)n(n+1)}{2(b - 1)} - \left(n + \frac{1}{b-1} \right)^2\] \[= - \frac{(b-3)(b-1)(n-1)n + 2}{2 (b-1)^2}\]<p>This means that the average error grows quadratically with respect to $n$. The typical way the error was redices was by having several counters and averaging their results. That analysis can be shown to reduce the error, but that is for another post.</p><h4 id="note">Note</h4><p>The formula above with the variance, might have an error somewhere because it is pretty much negative for most of the bases. An interesting thing to note is that if $b=3$, the variance of the estimator is actually a constant, -0.25. I will review later, because I am tired right now. Lol</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/algorithms/'>Algorithms</a>, <a href='/categories/probability/'>Probability</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cute Counter - Jorge Duque&url=https://jiduque.github.io/posts/cute-counter/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cute Counter - Jorge Duque&u=https://jiduque.github.io/posts/cute-counter/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Cute Counter - Jorge Duque&url=https://jiduque.github.io/posts/cute-counter/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://jiduque.github.io/posts/cute-counter/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/wordzee/">The Stupid Games I Play: Wordzee</a><li><a href="/posts/walmart-hours-and-crime/">Walmart Hours and Crime</a><li><a href="/posts/sum-swamp/">Sum Swamp</a><li><a href="/posts/cute-counter/">Cute Counter</a><li><a href="/posts/wealth-distribution/">Wealth Distribution</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/sum-swamp/"><div class="card-body"> <span class="timeago small" > Feb 7, 2022 <i class="unloaded">2022-02-07T00:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Sum Swamp</h3><div class="text-muted small"><p> Introduction Several years ago I used to work at a math tutoring center and we would have monthly game nights. The first time I attended game night, I got to play a little game called Sum Swamp . ...</p></div></div></a></div><div class="card"> <a href="/posts/child-simulation/"><div class="card-body"> <span class="timeago small" > Mar 20, 2022 <i class="unloaded">2022-03-20T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Child Hoarding</h3><div class="text-muted small"><p> Initial Idea The other day I was thinking about a simple population model. Start with $N$ people, then select one of them with uniform probability and give it a child. So now there are $N+1$ people...</p></div></div></a></div><div class="card"> <a href="/posts/number-match/"><div class="card-body"> <span class="timeago small" > Apr 17 <i class="unloaded">2023-04-17T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Number Match: No-Match Game(s)</h3><div class="text-muted small"><p> Introduction to Number Match Easy Brain does it again! I’ve been playing their game Number Match and it’s pretty fun. The game is relatively straight forward: match pairs of numbers and clear the b...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/wealth-distribution/" class="btn btn-outline-primary" prompt="Older"><p>Wealth Distribution</p></a> <a href="/posts/wordzee/" class="btn btn-outline-primary" prompt="Newer"><p>The Stupid Games I Play: Wordzee</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="">Jorge Duque</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jiduque.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
